# æ„å»ºå’Œå·¥å…·è„šæœ¬

æœ¬ç›®å½•åŒ…å«ç”¨äºæ„å»ºã€ç‰ˆæœ¬ç®¡ç†å’Œå‘å¸ƒçš„è‡ªåŠ¨åŒ–è„šæœ¬ã€‚

## è„šæœ¬åˆ—è¡¨

### build.sh - macOS/Linux æ„å»ºè„šæœ¬

**ç”¨é€”**ï¼šåœ¨ macOS æˆ– Linux ä¸Šæ„å»º qsl-cardhub åº”ç”¨ã€‚

**ä½¿ç”¨æ–¹æ³•**ï¼š

```bash
./scripts/build.sh
```

**åŠŸèƒ½**ï¼š
- è‡ªåŠ¨æ£€æŸ¥ä¾èµ–ï¼ˆNode.jsã€npmã€Rustã€cargoï¼‰
- éªŒè¯ç‰ˆæœ¬å·ä¸€è‡´æ€§ï¼ˆCargo.toml vs tauri.conf.jsonï¼‰
- æ„å»ºå‰ç«¯ï¼ˆnpm run buildï¼‰
- æ‰“åŒ… Tauri åº”ç”¨ï¼ˆcargo tauri buildï¼‰
- å¤åˆ¶äº§ç‰©åˆ° dist/ ç›®å½•
- æ˜¾ç¤ºæ„å»ºæ‘˜è¦å’Œæ–‡ä»¶å¤§å°

**è¾“å‡º**ï¼š
- macOS: `dist/qsl-cardhub-v{version}-macos-universal.dmg`

**å‰ç½®è¦æ±‚**ï¼š
- Node.js 18+
- npm
- Rust 1.70+
- cargo
- macOS: Xcode Command Line Tools

**ç¤ºä¾‹è¾“å‡º**ï¼š

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  qsl-cardhub æ„å»ºè„šæœ¬
  ç‰ˆæœ¬: 0.1.0
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ£€æŸ¥ä¾èµ–...
âœ“ Node.js: v20.10.0
âœ“ npm: 10.2.3
âœ“ Rust: 1.75.0
âœ“ cargo: 1.75.0
âœ“ æ‰€æœ‰ä¾èµ–å·²æ»¡è¶³

æ„å»ºå‰ç«¯...
âœ“ å‰ç«¯æ„å»ºæˆåŠŸ

æ‰“åŒ… Tauri åº”ç”¨...
âœ“ Tauri åº”ç”¨æ‰“åŒ…æˆåŠŸ

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  æ„å»ºå®Œæˆï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“¦ äº§ç‰©:
  dist/qsl-cardhub-v0.1.0-macos-universal.dmg (15.2 MB)
```

---

### build.ps1 - Windows æ„å»ºè„šæœ¬

**ç”¨é€”**ï¼šåœ¨ Windows ä¸Šæ„å»º qsl-cardhub åº”ç”¨ã€‚

**ä½¿ç”¨æ–¹æ³•**ï¼š

```powershell
.\scripts\build.ps1
```

æˆ–ä½¿ç”¨ CMD å…¥å£ï¼š

```cmd
.\scripts\build.bat
```

**åŠŸèƒ½**ï¼š
- è‡ªåŠ¨æ£€æŸ¥ä¾èµ–ï¼ˆNode.jsã€npmã€Rustã€cargoï¼‰
- è‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿæ¶æ„ï¼ˆx64 æˆ– ARM64ï¼‰
- éªŒè¯ç‰ˆæœ¬å·ä¸€è‡´æ€§
- æ„å»ºå‰ç«¯
- æ‰“åŒ… Tauri åº”ç”¨
- å¤åˆ¶äº§ç‰©åˆ° dist\ ç›®å½•
- æ˜¾ç¤ºæ„å»ºæ‘˜è¦å’Œæ–‡ä»¶å¤§å°

**è¾“å‡º**ï¼š
- Windows x64: `dist\qsl-cardhub-v{version}-windows-x64.msi`
- Windows ARM64: `dist\qsl-cardhub-v{version}-windows-arm64.msi`

**å‰ç½®è¦æ±‚**ï¼š
- Node.js 18+
- npm
- Rust 1.70+
- cargo
- PowerShell 5.0+

**ç¤ºä¾‹è¾“å‡º**ï¼š

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  qsl-cardhub æ„å»ºè„šæœ¬
  ç‰ˆæœ¬: 0.1.0
  æ¶æ„: x64
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[âˆš] æ£€æŸ¥ä¾èµ–...
[âˆš] Node.js: v20.10.0
[âˆš] npm: 10.2.3
[âˆš] Rust: 1.75.0
[âˆš] cargo: 1.75.0
[âˆš] æ‰€æœ‰ä¾èµ–å·²æ»¡è¶³

[âˆš] æ„å»ºå‰ç«¯...
[âˆš] å‰ç«¯æ„å»ºæˆåŠŸ

[âˆš] æ‰“åŒ… Tauri åº”ç”¨...
[âˆš] Tauri åº”ç”¨æ‰“åŒ…æˆåŠŸ

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  æ„å»ºå®Œæˆï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

äº§ç‰©:
  dist\qsl-cardhub-v0.1.0-windows-x64.msi (12.8 MB)
```

---

### build.bat - Windows CMD å…¥å£

**ç”¨é€”**ï¼šæä¾› CMD ç¯å¢ƒä¸‹çš„å…¥å£ï¼Œè°ƒç”¨ PowerShell è„šæœ¬ã€‚

**ä½¿ç”¨æ–¹æ³•**ï¼š

```cmd
.\scripts\build.bat
```

**è¯´æ˜**ï¼š
- è‡ªåŠ¨æ£€æŸ¥ PowerShell æ˜¯å¦å¯ç”¨
- è°ƒç”¨ build.ps1 æ‰§è¡Œå®é™…æ„å»º
- ä¼ é€’é€€å‡ºç 

---

### sync-version.sh - ç‰ˆæœ¬åŒæ­¥è„šæœ¬

**ç”¨é€”**ï¼šå°†ç‰ˆæœ¬å·ä» Cargo.toml åŒæ­¥åˆ° tauri.conf.jsonã€‚

**ä½¿ç”¨æ–¹æ³•**ï¼š

```bash
./scripts/sync-version.sh
```

**åŠŸèƒ½**ï¼š
- ä» Cargo.toml è¯»å–ç‰ˆæœ¬å·
- éªŒè¯ç‰ˆæœ¬å·æ ¼å¼ï¼ˆsemver: X.Y.Zï¼‰
- æ›´æ–° tauri.conf.json ä¸­çš„ç‰ˆæœ¬å·
- æ˜¾ç¤ºåŒæ­¥å‰åçš„ç‰ˆæœ¬å¯¹æ¯”

**å‰ç½®è¦æ±‚**ï¼š
- bash
- sed (macOS/Linux)

**ä½¿ç”¨åœºæ™¯**ï¼š
1. ä¿®æ”¹ Cargo.toml ä¸­çš„ç‰ˆæœ¬å·å
2. åˆ›å»ºæ–°ç‰ˆæœ¬å‘å¸ƒå‰
3. éªŒè¯ç‰ˆæœ¬ä¸€è‡´æ€§æ—¶

**ç¤ºä¾‹è¾“å‡º**ï¼š

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  qsl-cardhub ç‰ˆæœ¬åŒæ­¥å·¥å…·
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â„¹ ä» Cargo.toml è¯»å–ç‰ˆæœ¬å·: 0.2.0
â„¹ tauri.conf.json å½“å‰ç‰ˆæœ¬: 0.1.0

â„¹ æ­£åœ¨æ›´æ–° tauri.conf.json...
âœ“ ç‰ˆæœ¬å·å·²åŒæ­¥: 0.1.0 â†’ 0.2.0

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ“ åŒæ­¥å®Œæˆï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

## å·¥ä½œæµç¨‹

### æœ¬åœ°å¼€å‘æ„å»º

1. **å¼€å‘æ¨¡å¼**ï¼ˆçƒ­é‡è½½ï¼‰ï¼š
   ```bash
   cargo tauri dev
   ```

2. **ç”Ÿäº§æ„å»º**ï¼ˆå®Œæ•´æ‰“åŒ…ï¼‰ï¼š
   ```bash
   # macOS/Linux
   ./scripts/build.sh

   # Windows
   .\scripts\build.ps1
   ```

### ç‰ˆæœ¬å‘å¸ƒæµç¨‹

1. **æ›´æ–°ç‰ˆæœ¬å·**ï¼š
   ```bash
   # ç¼–è¾‘ Cargo.toml
   # å°† version = "0.1.0" ä¿®æ”¹ä¸º version = "0.2.0"
   ```

2. **åŒæ­¥ç‰ˆæœ¬å·**ï¼š
   ```bash
   ./scripts/sync-version.sh
   ```

3. **æäº¤æ›´æ”¹**ï¼š
   ```bash
   git add Cargo.toml tauri.conf.json
   git commit -m "chore: bump version to 0.2.0"
   git push origin master
   ```

4. **åˆ›å»ºå‘å¸ƒæ ‡ç­¾**ï¼š
   ```bash
   git tag v0.2.0
   git push origin v0.2.0
   ```

5. **è‡ªåŠ¨æ„å»ºå’Œå‘å¸ƒ**ï¼š
   - GitHub Actions ä¼šè‡ªåŠ¨è§¦å‘
   - åœ¨ macOSã€Windows x64 å’Œ Windows ARM64 ä¸Šå¹¶è¡Œæ„å»º
   - åˆ›å»º GitHub Release
   - ä¸Šä¼ æ„å»ºäº§ç‰©

### PR æ„å»ºéªŒè¯

åˆ›å»º Pull Request åˆ° master åˆ†æ”¯æ—¶ï¼Œä¼šè‡ªåŠ¨è§¦å‘æ„å»ºéªŒè¯ï¼š

```bash
git checkout -b feature/my-feature
git add .
git commit -m "feat: add new feature"
git push origin feature/my-feature
# åœ¨ GitHub ä¸Šåˆ›å»º PRï¼Œæ„å»ºå°†è‡ªåŠ¨å¼€å§‹
```

---

## æ•…éšœæ’æŸ¥

### ä¾èµ–ç¼ºå¤±

**ç—‡çŠ¶**ï¼šè„šæœ¬æŠ¥å‘Šç¼ºå°‘ä¾èµ–

**è§£å†³**ï¼š
```bash
# å®‰è£… Node.js (ä½¿ç”¨ nvm)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 20

# å®‰è£… Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

### ç‰ˆæœ¬å·ä¸ä¸€è‡´

**ç—‡çŠ¶**ï¼šè„šæœ¬è­¦å‘Šç‰ˆæœ¬å·ä¸åŒ¹é…

**è§£å†³**ï¼š
```bash
./scripts/sync-version.sh
```

### æ„å»ºå¤±è´¥

**ç—‡çŠ¶**ï¼šå‰ç«¯æˆ– Tauri æ„å»ºå¤±è´¥

**è°ƒè¯•æ­¥éª¤**ï¼š
1. æ£€æŸ¥é”™è¯¯æ—¥å¿—
2. éªŒè¯ä¾èµ–ç‰ˆæœ¬ï¼š
   ```bash
   node --version  # åº”ä¸º 18+
   npm --version
   rustc --version  # åº”ä¸º 1.70+
   ```
3. æ¸…ç†ç¼“å­˜å¹¶é‡è¯•ï¼š
   ```bash
   # æ¸…ç†å‰ç«¯ç¼“å­˜
   cd web
   rm -rf node_modules dist
   npm install

   # æ¸…ç† Rust ç¼“å­˜
   cd ..
   cargo clean

   # é‡æ–°æ„å»º
   ./scripts/build.sh
   ```

### Windows æ‰§è¡Œç­–ç•¥é™åˆ¶

**ç—‡çŠ¶**ï¼šPowerShell è„šæœ¬æ— æ³•æ‰§è¡Œ

**é”™è¯¯ä¿¡æ¯**ï¼š
```
.\build.ps1 : æ— æ³•åŠ è½½æ–‡ä»¶ï¼Œå› ä¸ºåœ¨æ­¤ç³»ç»Ÿä¸Šç¦æ­¢è¿è¡Œè„šæœ¬
```

**è§£å†³**ï¼š
```powershell
# ä¸´æ—¶å…è®¸ï¼ˆå½“å‰ä¼šè¯ï¼‰
Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope Process

# æˆ–ä½¿ç”¨ CMD å…¥å£ï¼ˆæ¨èï¼‰
.\scripts\build.bat
```

### macOS sed å…¼å®¹æ€§é—®é¢˜

**ç—‡çŠ¶**ï¼šsync-version.sh åœ¨ Linux ä¸Šå¤±è´¥

**åŸå› **ï¼šmacOS å’Œ Linux çš„ sed è¯­æ³•ç•¥æœ‰ä¸åŒ

**è§£å†³**ï¼šè„šæœ¬å·²å¤„ç†æ­¤é—®é¢˜ï¼Œä½¿ç”¨ `$OSTYPE` æ£€æµ‹å¹³å°

---

## è„šæœ¬å¼€å‘

### ä¿®æ”¹è„šæœ¬

ä¿®æ”¹è„šæœ¬åï¼Œç¡®ä¿ï¼š

1. **æƒé™æ­£ç¡®**ï¼š
   ```bash
   chmod +x scripts/*.sh
   ```

2. **æ ¼å¼ä¸€è‡´**ï¼š
   - bash è„šæœ¬ä½¿ç”¨ LF æ¢è¡Œç¬¦
   - PowerShell è„šæœ¬ä½¿ç”¨ CRLF æ¢è¡Œç¬¦

3. **æµ‹è¯•æ‰€æœ‰å¹³å°**ï¼š
   - macOS: æœ¬åœ°æµ‹è¯•
   - Windows: æœ¬åœ°æµ‹è¯•æˆ– GitHub Actions
   - Linux: GitHub Actionsï¼ˆå¦‚éœ€è¦ï¼‰

### æ·»åŠ æ–°è„šæœ¬

åˆ›å»ºæ–°è„šæœ¬æ—¶ï¼š

1. æ·»åŠ åˆ° `scripts/` ç›®å½•
2. ä½¿ç”¨ä¸€è‡´çš„è¾“å‡ºæ ¼å¼ï¼ˆé¢œè‰²ã€ç¬¦å·ï¼‰
3. åŒ…å«é”™è¯¯å¤„ç†ï¼ˆ`set -e` æˆ– `$ErrorActionPreference = "Stop"`ï¼‰
4. æ›´æ–°æœ¬ README æ–‡æ¡£
5. åœ¨ .gitignore ä¸­æ’é™¤ä¸´æ—¶æ–‡ä»¶

---

## ç¯å¢ƒå˜é‡

è„šæœ¬ä½¿ç”¨çš„ç¯å¢ƒå˜é‡ï¼š

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `RUST_BACKTRACE` | Rust é”™è¯¯å›æº¯ | è„šæœ¬ä¸­æœªè®¾ç½® |
| `CARGO_TERM_COLOR` | Cargo è¾“å‡ºé¢œè‰² | è„šæœ¬ä¸­æœªè®¾ç½® |

GitHub Actions å·¥ä½œæµä¼šè®¾ç½®è¿™äº›å˜é‡ï¼Œæœ¬åœ°è„šæœ¬ä¾èµ–é»˜è®¤å€¼ã€‚

---

## ç›¸å…³æ–‡æ¡£

- [GitHub Actions å·¥ä½œæµæ–‡æ¡£](../.github/workflows/README.md)
- [é¡¹ç›® README](../README.md)
- [Tauri å®˜æ–¹æ–‡æ¡£](https://tauri.app/)
- [OpenSpec æ„å»ºè§„èŒƒ](../openspec/changes/build-and-packaging/)

---

## æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’æŸ¥éƒ¨åˆ†
2. æŸ¥çœ‹ GitHub Actions æ—¥å¿—
3. æäº¤ Issue åˆ°é¡¹ç›®ä»“åº“
