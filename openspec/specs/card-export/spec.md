### 需求：导出按钮入口

卡片管理页面必须提供导出按钮，允许用户将当前项目的卡片列表导出为 Excel 文件。

#### 场景：显示导出按钮

- **当** 用户进入卡片管理页面
- **那么** 页面顶部操作栏必须显示"导出"按钮

#### 场景：项目无卡片时禁用导出

- **当** 当前项目没有任何卡片
- **那么** 导出按钮必须处于禁用状态

---

### 需求：触发导出流程

用户点击导出按钮后，系统必须弹出文件保存对话框。

#### 场景：点击导出按钮

- **当** 用户点击"导出"按钮
- **那么** 系统必须弹出文件保存对话框
- **并且** 默认文件名必须为 `{项目名}_{时间戳}.xlsx`
- **并且** 时间戳格式必须为 `YYYYMMDDHHmmss`（如 `20260205143022`）

#### 场景：用户取消保存

- **当** 用户在保存对话框中点击取消
- **那么** 系统必须静默返回，不显示错误提示

---

### 需求：Excel 文件格式

导出的 Excel 文件必须符合标准 xlsx 格式，包含规定的列结构。

#### 场景：文件列结构

- **当** 导出完成
- **那么** Excel 文件必须包含以下列（按顺序）：
  - 第1列：序号
  - 第2列：呼号
  - 第3列：数量
  - 第4列：状态
  - 第5列：QRZ.cn(中文)
  - 第6列：QRZ.cn(English)
  - 第7列：QRZ.com

#### 场景：表头行

- **当** 打开导出的文件
- **那么** 第一行必须为表头行，内容为：序号、呼号、数量、状态、QRZ.cn(中文)、QRZ.cn(English)、QRZ.com

---

### 需求：导出地址缓存列

系统在导出 Excel 时必须增加三列地址缓存字段，并且必须仅使用卡片缓存数据填充。

#### 场景：按来源填充三列

- **当** 卡片 `metadata.address_cache` 同时包含 `qrz.cn` 和 `qrz.com` 缓存
- **那么** `QRZ.cn(中文)` 列必须写入 `qrz.cn` 的 `chinese_address`
- **并且** `QRZ.cn(English)` 列必须写入 `qrz.cn` 的 `english_address`
- **并且** `QRZ.com` 列必须写入 `qrz.com` 的 `english_address`

#### 场景：无缓存时留空

- **当** 卡片不存在 `address_cache` 或无对应来源记录
- **那么** `QRZ.cn(中文)`、`QRZ.cn(English)`、`QRZ.com` 三列必须写入空单元格

#### 场景：部分缓存时部分填充

- **当** 卡片仅有 `qrz.cn` 缓存而无 `qrz.com` 缓存
- **那么** `QRZ.cn(中文)` 与 `QRZ.cn(English)` 必须按缓存写入
- **并且** `QRZ.com` 列必须为空

---

### 需求：序号字段导出

序号字段必须导出卡片的 serial 值，格式为三位数。

#### 场景：序号格式

- **当** 卡片 serial 值为 1
- **那么** 导出的序号必须显示为 `001`

#### 场景：序号为空

- **当** 卡片 serial 值为空
- **那么** 导出的序号必须显示为空单元格

---

### 需求：呼号字段导出

呼号字段必须原样导出卡片的 callsign 值。

#### 场景：呼号原样输出

- **当** 卡片呼号为 `BV2AAA`
- **那么** 导出的呼号必须为 `BV2AAA`

---

### 需求：数量字段导出

数量字段必须根据系统配置决定显示精确值或大致范围。

#### 场景：精确模式导出

- **当** 系统配置为精确显示模式
- **并且** 卡片数量为 15
- **那么** 导出的数量必须为 `15`

#### 场景：大致模式导出 - 小于等于10

- **当** 系统配置为大致显示模式
- **并且** 卡片数量为 8
- **那么** 导出的数量必须为 `≤10`

#### 场景：大致模式导出 - 小于等于50

- **当** 系统配置为大致显示模式
- **并且** 卡片数量为 35
- **那么** 导出的数量必须为 `≤50`

#### 场景：大致模式导出 - 大于50

- **当** 系统配置为大致显示模式
- **并且** 卡片数量为 100
- **那么** 导出的数量必须为 `>50`

---

### 需求：状态字段导出

状态字段必须导出卡片当前状态的中文描述。

#### 场景：待分发状态

- **当** 卡片状态为 `pending`
- **那么** 导出的状态必须为 `待分发`

#### 场景：已分发状态

- **当** 卡片状态为 `distributed`
- **那么** 导出的状态必须为 `已分发`

#### 场景：已退卡状态

- **当** 卡片状态为 `returned`
- **那么** 导出的状态必须为 `已退卡`

---

### 需求：文件名安全处理

当项目名包含文件系统非法字符时，系统必须进行清理。

#### 场景：清理非法字符

- **当** 项目名为 `Test/Project:2026`
- **那么** 生成的文件名必须将非法字符替换为下划线
- **并且** 结果类似 `Test_Project_2026_20260205143022.xlsx`

---

### 需求：导出结果反馈

导出完成后，系统必须向用户反馈结果。

#### 场景：导出成功

- **当** 文件成功写入磁盘
- **那么** 系统必须显示成功提示消息

#### 场景：导出失败

- **当** 文件写入失败（如权限不足）
- **那么** 系统必须显示错误提示消息
- **并且** 消息必须包含失败原因
