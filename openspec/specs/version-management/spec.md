# version-management Specification

## Purpose
TBD - created by archiving change add-version-management. Update Purpose after archive.
## 需求
### 需求：版本号升级脚本

系统必须提供一键升级版本号的脚本，支持语义化版本控制。

#### 场景：升级主版本号

- **当** 开发者执行 `./scripts/version.sh major`
- **那么** 脚本必须将主版本号加 1（如 `1.2.3` → `2.0.0`）
- **并且** 必须将次版本号和补丁版本号重置为 0
- **并且** 必须同步更新 `Cargo.toml`、`tauri.conf.json`、`web/package.json` 中的版本号
- **并且** 必须输出版本变更信息（旧版本 → 新版本）

#### 场景：升级次版本号

- **当** 开发者执行 `./scripts/version.sh minor`
- **那么** 脚本必须将次版本号加 1（如 `1.2.3` → `1.3.0`）
- **并且** 必须将补丁版本号重置为 0
- **并且** 必须同步更新所有配置文件中的版本号

#### 场景：升级补丁版本号

- **当** 开发者执行 `./scripts/version.sh patch`
- **那么** 脚本必须将补丁版本号加 1（如 `1.2.3` → `1.2.4`）
- **并且** 必须同步更新所有配置文件中的版本号

#### 场景：自定义版本号

- **当** 开发者执行 `./scripts/version.sh 2.0.0`
- **那么** 脚本必须验证版本号格式符合 semver 规范（`X.Y.Z`）
- **并且** 必须将所有配置文件的版本号更新为指定值
- **并且** 如果格式不正确，必须输出错误信息并退出

#### 场景：显示当前版本

- **当** 开发者执行 `./scripts/version.sh`（无参数）
- **那么** 脚本必须显示当前版本号
- **并且** 必须显示最近的 Git 标签（如果存在）

---

### 需求：版本发布脚本

系统必须提供一键发布版本的脚本，整合版本升级、构建验证和 Git 操作。

#### 场景：标准发布流程

- **当** 开发者执行 `./scripts/release.sh patch`
- **那么** 脚本必须检查当前是否在 master/main 分支
- **并且** 必须检查工作区是否干净（无未提交更改）
- **并且** 必须拉取最新代码（`git fetch && git pull`）
- **并且** 必须调用 `version.sh` 升级版本号
- **并且** 必须执行 `cargo check` 验证 Rust 代码
- **并且** 必须创建版本提交（如 `chore: bump version to 0.4.0`）
- **并且** 必须创建 Git 标签（如 `v0.4.0`）
- **并且** 必须询问是否推送到远程

#### 场景：非主分支发布警告

- **当** 开发者在非 master/main 分支执行 release.sh
- **那么** 脚本必须输出警告信息
- **并且** 必须询问是否继续
- **并且** 如果用户选择不继续，必须退出

#### 场景：工作区不干净

- **当** 开发者在有未提交更改时执行 release.sh
- **那么** 脚本必须输出错误信息
- **并且** 必须显示未提交的文件列表
- **并且** 必须以非零退出码退出

#### 场景：版本标签已存在

- **当** 要创建的版本标签已存在
- **那么** 脚本必须输出错误信息
- **并且** 必须提示删除已存在的标签或使用其他版本号
- **并且** 必须以非零退出码退出

---

### 需求：版本号文件同步

系统必须确保版本号在所有配置文件中保持一致。

#### 场景：构建前版本同步

- **当** 执行 `npm run build` 构建前端
- **那么** 必须先运行 `sync-version.js` 同步版本号
- **并且** 必须将 `Cargo.toml` 中的版本号同步到 `web/package.json`
- **并且** 必须输出同步结果

#### 场景：版本不一致检测

- **当** 开发者执行 `./scripts/version.sh check`
- **那么** 脚本必须检查 `Cargo.toml`、`tauri.conf.json`、`web/package.json` 中的版本号
- **并且** 如果版本号不一致，必须输出所有文件的版本号
- **并且** 必须建议运行同步命令

---

### 需求：关于页面版本显示

应用的关于页面必须动态显示当前版本号，而非硬编码。

#### 场景：显示应用版本

- **当** 用户打开关于页面
- **那么** 版本号必须从应用配置中动态读取
- **并且** 版本号必须与 `Cargo.toml` 中的值一致
- **并且** 版本号格式必须为 `vX.Y.Z`（如 `v0.3.0`）

#### 场景：显示构建信息

- **当** 用户打开关于页面
- **那么** 可选显示构建日期
- **并且** 可选显示 Git 提交哈希（短格式）

