# sf-express-integration 规范增量

## 修改需求

### 需求：顺丰配置管理

系统**必须**提供顺丰速运 API 配置管理功能，支持默认预配置参数和自定义参数两种模式。

#### 场景：配置界面智能展开面板

**前提条件：**
- 用户打开顺丰速运配置页面

**预期结果：**
- 如果未配置 API 凭据（顾客编码为空），自动展开「API 凭据配置」面板
- 如果已配置 API 凭据，自动展开「寄件人信息」面板

---

#### 场景：使用默认预配置参数

**前提条件：**
- 配置文件中存在有效的默认 API 参数

**操作步骤：**
1. 用户打开「数据配置 > 顺丰速运」页面
2. 用户在「参数来源」中选择「使用默认参数」
3. 用户选择环境（生产/沙箱）
4. 用户点击「保存」

**预期结果：**
- 系统使用配置文件中的默认参数
- 顾客编码和校验码输入框显示为只读状态
- 显示风险警告提示「该参数不可滥用，有随时停用或更换的风险，请尽量使用自定义参数」
- 配置保存成功后显示「已保存凭据」状态

---

#### 场景：使用自定义参数

**前提条件：**
- 用户选择使用自定义参数

**操作步骤：**
1. 用户在「参数来源」中选择「使用自定义参数」
2. 系统显示顺丰开放平台申请提示和链接
3. 用户输入自己的顾客编码和校验码
4. 用户点击「保存」

**预期结果：**
- 显示提示文字「前往 顺丰开放平台 申请您自己的 API 凭据」
- 提示中的「顺丰开放平台」为可点击链接，指向 https://open.sf-express.com/
- 输入框可编辑
- 配置保存成功

---

#### 场景：默认参数不可用时

**前提条件：**
- 配置文件中未配置默认参数或参数无效

**操作步骤：**
1. 用户打开「数据配置 > 顺丰速运」页面

**预期结果：**
- 「使用默认参数」选项被禁用
- 自动选中「使用自定义参数」
- 显示自定义参数输入界面

---

## 新增需求

### 需求：下单前配置检查

系统**必须**在打开下单界面时检查 API 配置状态和寄件人配置状态。

#### 场景：API 未配置时打开下单界面

**前提条件：**
- 用户未配置顺丰 API 凭据

**操作步骤：**
1. 用户从分发界面点击「顺丰速运下单」按钮
2. 系统打开下单对话框

**预期结果：**
- 在寄件人信息区域上方显示警告提示「请先配置顺丰速运 API」
- 提供「去配置」按钮，点击后跳转到顺丰速运配置页面
- 「提交订单」按钮处于禁用状态

---

### 需求：下单配置跳转

系统**必须**支持从下单界面跳转到配置界面。

#### 场景：从下单界面跳转到配置

**前提条件：**
- 用户在下单界面看到「去配置」提示

**操作步骤：**
1. 用户点击「去配置」按钮

**预期结果：**
- 下单对话框关闭
- 分发对话框关闭（如有）
- 导航到「数据配置 > 顺丰速运」页面
- 自动展开「API 凭据配置」面板（如果是 API 未配置）
- 自动展开「寄件人信息」面板（如果是寄件人未配置）

---

### 需求：下单表单重置

系统**必须**在每次打开下单对话框时重置收件人表单。

#### 场景：重新打开下单对话框

**前提条件：**
- 用户之前填写过收件人信息

**操作步骤：**
1. 用户打开下单对话框
2. 用户填写收件人信息
3. 用户关闭对话框（取消或完成）
4. 用户再次打开下单对话框

**预期结果：**
- 收件人表单被重置为空
- 如果有传入默认收件人信息（如从卡片地址缓存），则填充该信息
- 表单验证状态被清除，不显示之前的验证错误
