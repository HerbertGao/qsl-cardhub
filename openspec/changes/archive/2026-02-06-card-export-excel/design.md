## 上下文

用户在卡片管理页面完成分发工作后，需要将数据导出为 Excel 文件进行存档。当前系统已具备：
- 完整的卡片数据模型（Card, CardStatus）
- 项目管理功能（Project）
- tauri-plugin-dialog 用于文件对话框
- 成熟的 Tauri 命令架构

## 目标 / 非目标

**目标：**
- 实现一键导出当前项目卡片列表为 xlsx 文件
- 用户可选择保存位置
- 导出字段清晰、格式规范

**非目标：**
- 不支持导出多个项目
- 不支持自定义导出字段
- 不支持其他格式（CSV、PDF 等）
- 不支持导入功能

## 决策

### 1. xlsx 生成库选择

**选择：`rust_xlsxwriter`**

| 库 | 优点 | 缺点 |
|---|---|---|
| rust_xlsxwriter | 纯 Rust、功能全面、积极维护、API 友好 | 体积稍大 |
| simple_excel_writer | 轻量 | 功能有限、维护不活跃 |
| calamine | 读写都支持 | 主要优化读取场景 |

**理由**：rust_xlsxwriter 提供完整的 xlsx 写入支持，API 清晰，且项目已使用 release 优化配置，体积影响可控。

### 2. 文件保存方式

**选择：使用 tauri-plugin-dialog 的保存对话框**

- 用户可自选保存位置
- 默认文件名：`{项目名}_{YYYYMMDDHHmmss}.xlsx`
- 复用现有依赖，无需额外引入

**替代方案（未采用）**：
- 固定保存到 Downloads 目录 → 用户体验差，不够灵活

### 3. 数量显示模式

**选择：沿用系统配置的显示模式**

根据系统配置决定导出精确数值还是大致范围：
- 精确模式：显示实际数字（如 `15`）
- 大致模式：显示范围（`≤10`、`≤50`、`>50`）

**理由**：保持与 UI 显示一致，避免用户困惑。

### 4. 状态文本映射

| status 值 | 导出显示 |
|-----------|----------|
| pending | 待分发 |
| distributed | 已分发 |
| returned | 已退卡 |

### 5. 架构设计

```
┌─────────────┐     ┌──────────────────┐     ┌─────────────────┐
│  前端 UI    │────▶│  Tauri Command   │────▶│  Excel 生成     │
│ 导出按钮    │     │ export_cards_cmd │     │ rust_xlsxwriter │
└─────────────┘     └──────────────────┘     └─────────────────┘
                            │
                            ▼
                    ┌──────────────────┐
                    │  文件保存对话框   │
                    │ tauri-plugin-    │
                    │ dialog           │
                    └──────────────────┘
```

**数据流**：
1. 用户点击"导出"按钮
2. 前端调用 `export_cards_cmd(project_id)`
3. 后端查询该项目所有卡片
4. 生成 xlsx 内容到内存
5. 弹出保存对话框，用户选择路径
6. 写入文件，返回成功/失败

## 风险 / 权衡

| 风险 | 缓解措施 |
|------|----------|
| 大量卡片导出可能卡顿 | 使用流式写入，避免一次性加载全部数据到内存 |
| 文件名中项目名包含特殊字符 | 清理非法文件名字符（`/\:*?"<>|`） |
| 用户取消保存对话框 | 返回取消状态，前端不显示错误 |

## 文件结构

```
src/
├── commands/
│   └── export.rs          # 新增：导出命令
├── db/
│   └── cards.rs           # 可能需要新增查询方法
└── lib.rs                  # 注册新命令

ui/src/
└── views/
    └── CardManagement.vue  # 添加导出按钮
```
