## 修改需求

### 需求：卡片分发功能

系统必须提供卡片分发功能，记录分发方式、地址和备注。

#### 场景：分发卡片（支持任意状态）

- **当** 用户点击"分发"按钮
- **那么** 系统必须显示分发弹窗（允许对任意状态的卡片执行分发操作）
- **并且** 弹窗必须包含：
  - 基本信息区域（只读）：转卡项目、呼号、数量、当前状态、录入时间
  - 分发信息区域：
    - 处理方式（单选，带边框）：快递、挂号信、平邮、自取、代领、其它
    - 代领人选择器（仅当选择"代领"时显示）：
      - 下拉选择框，选项为本次转卡的所有呼号（去重）
      - 支持筛选功能，用户可以通过输入关键词快速查找呼号
      - 支持 `allow-create` 功能，允许用户输入不在本次转卡中的呼号
      - 临时输入的呼号仅用于本次分发，不保存到后台数据库
    - 备注（多行文本输入框，带复制/粘贴按钮）
  - 收件地址区域（只读，预留字段）
- **并且** 用户填写并提交
- **那么** 系统必须更新卡片记录：
  - `status` 更新为 `distributed`
  - `metadata` 添加或更新 `distribution` 对象（保留已有的 `return` 信息）：
    ```json
    {
      "distribution": {
        "method": "代领",
        "address": null,
        "remarks": "用户输入的备注",
        "proxy_callsign": "BG7XYZ",
        "distributed_at": "2026-01-21T15:30:00+08:00"
      }
    }
    ```
    - 当处理方式为"代领"且提供了代领人时，`proxy_callsign` 字段包含代领人呼号
    - 当处理方式为"代领"但未提供代领人时，`proxy_callsign` 字段为 `null`
    - 当处理方式不是"代领"时，不包含 `proxy_callsign` 字段
  - `updated_at` 更新为当前时间

#### 场景：重新分发或修改分发信息

- **当** 卡片状态为 `distributed` 或 `returned`
- **并且** 用户点击"分发"按钮
- **那么** 系统允许重新分发（视为修改操作）
- **并且** 新的分发信息会覆盖旧的分发信息
- **并且** 退回信息（如果有）保持不变

#### 场景：选择代领处理方式

- **当** 用户在分发对话框中选择"代领"处理方式
- **那么** 系统必须显示代领人选择器
- **并且** 代领人选择器必须加载本次转卡（project）的所有呼号（去重）作为选项
- **并且** 用户可以通过输入关键词筛选呼号列表
- **并且** 用户可以选择列表中的呼号，也可以输入不在列表中的呼号
- **并且** 当用户输入不在列表中的呼号时，该呼号仅用于本次分发，不会保存到后台数据库

#### 场景：代领人字段验证

- **当** 用户选择"代领"处理方式
- **并且** 用户未填写代领人
- **那么** 系统必须显示验证错误提示
- **并且** 不得提交表单
- **当** 用户选择其他处理方式
- **那么** 系统必须隐藏代领人选择器
- **并且** 不验证代领人字段

> **设计说明**：允许对任意状态的卡片执行分发操作，支持以下场景：
> - 待分发(pending) → 已分发(distributed)：首次分发
> - 已分发(distributed) → 已分发(distributed)：修改分发信息
> - 已退回(returned) → 已分发(distributed)：重新分发
>
> 分发信息和退回信息独立存储在 metadata 中，互不覆盖。
>
> 代领人选择器使用 Element Plus 的 `el-select` 组件，配置 `filterable` 和 `allow-create` 属性。
