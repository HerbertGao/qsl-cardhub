## MODIFIED Requirements

### 需求：顺丰下单功能

系统**必须**支持通过顺丰开放平台 API 创建订单。

#### 场景：从分发界面下单

**前提条件：**
- 用户已配置顺丰凭据
- 用户已配置至少一个寄件人信息
- 用户在卡片分发界面选择了"快递"方式

**操作步骤：**
1. 用户在分发对话框中点击「顺丰速运下单」按钮
2. 系统打开下单对话框
3. 系统自动预填默认寄件人信息
4. 用户填写或确认收件人信息：
   - 收件人姓名（必填）
   - 收件人电话（必填）
   - 收件人手机（可选）
   - 收件地址（省市区详细地址，支持地址选择器）
5. 用户确认订单信息
6. 用户点击「提交并确认订单」
7. 系统调用 EXP_RECE_CREATE_ORDER 接口创建订单
8. 系统检查 filter_result，如果可收派则自动调用 EXP_RECE_UPDATE_ORDER 接口确认订单
9. 确认成功后系统自动获取并打印面单

**预期结果：**
- 订单创建并确认成功，返回运单号（waybillNo）
- 面单自动发送到打印机
- 订单保存到本地数据库，状态为"已确认"
- 弹窗关闭，运单号自动回填到分发备注
- 如果创建失败，显示具体错误信息

#### 场景：filter_result 为可收派时自动确认

- **当** sf_create_order 返回的 filter_result 为 2（可收派）
- **那么** 系统**必须**自动调用 sf_confirm_order 确认订单
- **并且** 用户**禁止**被要求进行额外的确认操作

#### 场景：filter_result 为人工确认时提示用户

- **当** sf_create_order 返回的 filter_result 为 1（人工确认）
- **那么** 系统**必须**弹出确认对话框提示用户该地区需要人工确认
- **并且** 用户选择继续时，系统**必须**调用 sf_confirm_order 确认订单
- **并且** 用户选择取消时，订单**必须**保留为 pending 状态

#### 场景：filter_result 为不可收派时拒绝确认

- **当** sf_create_order 返回的 filter_result 为 3（不可收派）
- **那么** 系统**必须**显示错误提示告知用户该地区不可收派
- **并且** 系统**禁止**自动确认订单
- **并且** 订单**必须**保留为 pending 状态

#### 场景：确认成功后自动打印面单

- **当** 订单确认成功且已获取运单号
- **那么** 系统**必须**自动调用 sf_fetch_waybill 获取面单 PDF
- **并且** 系统**必须**自动调用 sf_print_waybill 将面单发送到已配置的打印机
- **并且** 打印成功后订单状态**必须**更新为 "printed"

#### 场景：打印机未配置时跳过打印

- **当** 订单确认成功但系统未配置打印机（打印机名称为空）
- **那么** 系统**必须**跳过自动打印步骤
- **并且** 系统**必须**提示用户「订单已确认，请配置打印机后手动打印面单」
- **并且** 订单状态**必须**为 "confirmed"

#### 场景：打印失败时不影响订单状态

- **当** 面单获取或打印过程中发生错误
- **那么** 系统**必须**显示打印失败的警告提示
- **并且** 系统**禁止**回滚订单的确认状态
- **并且** 订单状态**必须**保持为 "confirmed"

#### 场景：下单数据验证

**操作步骤：**
1. 用户填写下单表单
2. 用户点击「提交并确认订单」
3. 系统验证必填字段

**预期结果：**
- 如果必填字段缺失，显示具体错误提示
- 如果电话号码格式不正确，显示格式错误提示
- 如果地址信息不完整，提示补充地址信息
- 验证通过后才调用 API

#### 场景：默认付款方式为到付

- **当** 用户打开下单对话框
- **那么** 付款方式**必须**默认选中「收方付」（值为 2）
- **并且** 用户仍可手动切换为「寄方付」

### 需求：下单表单重置

系统**必须**在每次打开下单对话框时重置收件人表单。

#### 场景：重新打开下单对话框

**前提条件：**
- 用户之前填写过收件人信息

**操作步骤：**
1. 用户打开下单对话框
2. 用户填写收件人信息
3. 用户关闭对话框（取消或完成）
4. 用户再次打开下单对话框

**预期结果：**
- 收件人表单被重置为空
- 付款方式重置为「收方付」（默认值）
- 如果有传入默认收件人信息（如从卡片地址缓存），则填充该信息
- 表单验证状态被清除，不显示之前的验证错误
