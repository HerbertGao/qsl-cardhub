# 模板配置系统 - 增量规范

## 新增需求

### 需求：文字宽度测量精度
文字渲染系统必须使用实际像素边界框测量文字宽度，而非字体排版宽度，以确保布局计算的准确性和文字的精确居中。

#### 场景：测量包含中文的文本
- **当** 测量包含中文字符的文本（如"中国无线电协会业余分会-2区卡片局"）
- **那么** 返回的宽度必须等于实际渲染后的像素宽度（使用 `pixel_bounding_box` 计算）
- **并且** 宽度计算必须考虑字形向左或向右延伸的情况

#### 场景：文字居中对称性
- **当** 使用 center 对齐渲染文字元素
- **那么** 元素左边距和右边距的差异必须 ≤ 1 个像素
- **并且** 实际渲染的像素分布必须左右对称

### 需求：边框与内容区域分离
边框必须绘制在 margin 边界（外框），内容区域必须在边框内侧（内框），两者计算逻辑完全分离。

#### 场景：启用边框时的内容区域
- **当** 模板配置启用边框（`border = true`）
- **那么** 边框必须绘制在 `margin_left`, `margin_top`, `margin_right`, `margin_bottom` 定义的边界上
- **并且** 内容区域必须向内缩进 `border_thickness` 的距离
- **并且** 所有元素必须在边框内边界范围内渲染

#### 场景：边框配置信息输出
- **当** 布局引擎计算边框配置
- **那么** 必须输出调试日志显示边框的 x, y, width, height, thickness
- **并且** 必须输出内容区域的左右边界信息

### 需求：文字安全边距
文字元素布局时必须预留安全边距，避免文字过于接近边框或边界。

#### 场景：计算文字最大字号
- **当** 为文字元素计算最大字号
- **那么** 必须从可用宽度中减去约 1mm 的安全边距（两侧总计）
- **并且** 安全边距的计算必须使用 `mm_to_dots(1.0, dpi)` 确保在不同 DPI 下一致

#### 场景：安全边距边界检查
- **当** 可用宽度小于或等于安全边距
- **那么** 使用原始可用宽度（不减去安全边距）
- **并且** 记录警告日志

### 需求：模板文件路径配置
模板文件加载路径必须正确配置，在开发模式下能够从项目根目录相对路径加载模板文件。

#### 场景：开发模式加载默认模板
- **当** 在开发模式下（`debug_assertions` 启用）加载默认模板
- **那么** 必须使用路径 `config/templates/default.toml`（从项目根目录开始）
- **并且** 必须成功加载模板配置文件
- **并且** 输出日志显示成功加载的模板路径

#### 场景：模板加载失败回退
- **当** 从文件加载模板失败
- **那么** 必须输出警告日志说明加载失败原因
- **并且** 必须回退到硬编码的默认模板配置
- **并且** 系统必须继续正常运行

### 需求：布局计算调试信息
布局引擎必须提供详细的调试日志，帮助开发者诊断对齐和间距问题。

#### 场景：元素水平对齐日志
- **当** 布局引擎计算元素的水平位置
- **那么** 必须为每个元素输出调试日志
- **并且** 日志必须包含：元素 ID, x 坐标, width, 右边界位置（x + width）

#### 场景：内容区域边界日志
- **当** 启用边框时计算内容区域
- **那么** 必须输出调试日志显示内容区域的左右边界
- **并且** 日志格式必须清晰说明边界计算方式（如 "border_x + thickness"）
