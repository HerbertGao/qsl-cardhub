# 前端界面操作优化 - 任务清单

## 阶段 1：数据模型和配置重构

### 任务 1.1：卡片表增加序列号字段
- [x] 数据库迁移：`cards` 表添加 `serial` INTEGER 字段（可为空）
- [x] 后端 Card 结构体增加 `serial: Option<i32>` 字段
- [x] 前端 Card 类型增加 `serial: number | null` 字段
- [x] 更新 `create_card` 命令支持 serial 参数
- **验证**：卡片创建时可保存序列号，查询时正确返回

### 任务 1.2：task_name 重命名为 project_name
- [x] 打印模板配置文件：`task_name` 重命名为 `project_name`
- [x] 后端打印数据结构：`task_name` 字段改为 `project_name`
- [x] `print_qsl` 命令：参数 task_name 改为 project_name
- [x] 更新所有使用 task_name 的代码引用
- **验证**：打印输出正确使用 project_name 显示项目名称

### 任务 1.3：后端配置从多配置改为单配置
- [x] 新建单配置结构 `SinglePrinterConfig`（仅包含 printer.name）
- [x] 实现 `get_printer_config` 命令（返回单配置）
- [x] 实现 `save_printer_config` 命令（保存单配置）
- [x] 保留多配置接口但标记为废弃
- **验证**：单配置读写正常

### 任务 1.4：删除独立打印页面
- [x] 删除 `PrintView.vue` 文件
- [x] 移除 `App.vue` 中的 PrintView 导入和引用
- **验证**：应用编译通过，无打印页面残留

### 任务 1.5：菜单结构重构
- [x] `App.vue` 移除「打印」菜单项
- [x] 「打印配置」改为 `el-sub-menu`，索引 `print-config-menu`
- [x] 添加二级菜单「打印机配置」，索引 `print-config-printer`
- [x] 添加二级菜单「标签模板配置」，索引 `print-config-template`
- [x] 移除原独立的「打印模板」菜单项
- [x] 更新主内容区的条件渲染逻辑
- **验证**：菜单显示正确，二级菜单展开收起正常

### 任务 1.6：前端配置页面重构
- [x] `ConfigView.vue` 重构为单配置编辑页面
- [x] 移除配置列表、新建、删除功能
- [x] 改为直接显示打印机选择下拉框
- [x] 添加保存按钮，调用 `save_printer_config`
- [x] 页面加载时调用 `get_printer_config` 获取配置
- **验证**：打印机配置页面正常工作

### 任务 1.7：模板页面标题变更
- [x] `TemplateView.vue` 页面标题改为「标签模板配置」
- **验证**：页面标题显示正确

---

## 阶段 2：录入卡片集成打印功能（依赖阶段 1）

### 任务 2.1：后端序列号查询接口
- [x] 实现 `get_max_serial` 命令
- [x] 查询指定项目下所有卡片的 serial 字段
- [x] 返回最大序列号（数字），如果没有卡片返回 0
- **验证**：接口正确返回项目最大序列号

### 任务 2.2：扩展录入对话框 UI（序列号区域）
- [x] `CardInputDialog.vue` 在数量下方添加序列号输入框
- [x] 添加序列号预览（三位数格式）
- [x] 添加重置序列号按钮
- [x] 添加「跳过包含数字 4 的序列号」复选框（默认勾选）
- [x] 实现跳过4功能（向上/向下）
- [x] 连续模式下序列号自动递增（无论是否打印）
- **验证**：序列号输入、跳过4、自动递增功能正常

### 任务 2.3：序列号自动计算
- [x] 对话框打开时调用 `get_max_serial` 获取最大序列号
- [x] 最大序列号 +1 作为默认值（如果为 0 则默认 1）
- [x] 应用跳过4逻辑（如果勾选）
- [x] 切换项目时重新计算序列号
- **验证**：打开对话框时自动填充正确的序列号

### 任务 2.4：扩展录入对话框 UI（打印设置）
- [x] 添加「打印标签」复选框（默认勾选）
- [x] 按钮文字根据打印状态动态切换（录入/录入并打印）
- [x] 打印时从全局配置获取打印机
- [x] 如果未配置打印机，提交时提示用户先配置
- **验证**：UI 正确显示，勾选状态切换正常

### 任务 2.5：录入并打印逻辑
- [x] `CardManagementView.vue` 处理 confirm 事件中的 printEnabled 标志
- [x] 创建卡片记录时包含序列号
- [x] 打印时使用所选项目名称作为 project_name、卡片序列号
- [x] 打印成功/失败均提示用户
- [x] 打印失败不影响录入成功
- **验证**：录入后自动打印标签，打印内容正确，序列号正确保存

---

## 阶段 3：卡片列表操作布局优化（可并行）

### 任务 3.1：卡片列表显示序列号
- [x] `CardList.vue` 表格添加「序列号」列
- [x] 序列号显示为三位数格式（如 "001"）
- [x] 无序列号的历史卡片显示为 "-"
- **验证**：序列号列正确显示

### 任务 3.2：呼号列添加操作按钮
- [x] `CardList.vue` 呼号列后添加查看按钮（圆形小图标，Search）
- [x] 添加复制呼号按钮（圆形小图标，CopyDocument）
- [x] 复制功能使用 Clipboard API
- [x] 复制成功显示提示
- **验证**：按钮正确显示，点击查看打开详情，点击复制呼号到剪贴板

### 任务 3.3：操作列布局调整
- [x] 分发按钮移出更多菜单，作为主操作按钮显示
- [x] 更多菜单新增「打印标签」选项
- [x] 「打印面单」改为「打印顺丰面单」
- [x] 菜单顺序调整：打印标签、打印顺丰面单、退回、删除
- **验证**：按钮位置正确，功能正常

### 任务 3.4：打印标签功能（从列表）
- [x] 实现从卡片列表打印标签
- [x] 直接使用卡片已保存的序列号（无需再次输入）
- [x] 使用卡片所属项目名称作为 project_name
- [x] 打印成功/失败提示
- **验证**：从列表可以打印标签，使用卡片的序列号

---

## 阶段 4：通用化和代码优化

### 任务 4.1：序列号格式化通用函数
- [x] 新建 `web/src/utils/format.ts` 工具文件
- [x] 实现 `formatSerial()` 通用函数
- [x] 更新 `CardInputDialog.vue` 使用通用函数
- [x] 更新 `CardList.vue` 使用通用函数
- [x] 更新 `CardManagementView.vue` 使用通用函数
- [x] 更新 `DistributeDialog.vue` 使用通用函数
- [x] 更新 `CardDetailDialog.vue` 使用通用函数
- [x] 更新 `ReturnDialog.vue` 使用通用函数
- **验证**：所有序列号显示统一使用三位前导零格式

### 任务 4.2：清理未使用代码
- [x] 删除 `CardList.vue` 中未使用的 `indexMethod` 函数
- **验证**：类型检查通过，无未使用变量警告

---

## 验收标准

1. ✅ 卡片数据模型：包含序列号字段，录入时保存
2. ✅ 菜单结构：「打印配置」为二级菜单，包含「打印机配置」和「标签模板配置」
3. ✅ 独立打印页面已移除
4. ✅ 配置管理：单配置模式，无多配置管理
5. ✅ 命名统一：task_name 已全部改为 project_name
6. ✅ 录入卡片：序列号在数量下方，可选择是否打印标签，默认打印
7. ✅ 卡片列表：显示序列号列，操作布局符合设计
8. ✅ 打印输出正确显示项目名称（project_name）和序列号
9. ✅ 序列号格式化统一使用通用函数
10. ✅ 无功能回归
