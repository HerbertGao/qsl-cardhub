# 提案：整合迁移文件并更新版本号规则

## 为什么

当前迁移文件存在以下问题：

1. **文件碎片化**：存在多个小型迁移文件，如 `004_add_pay_method.sql` 和 `005_add_cargo_name.sql` 只是简单的 ALTER TABLE
2. **版本号不直观**：简单的递增数字（001, 002...）无法反映迁移的创建时间
3. **相关变更分散**：同一功能的数据库变更分布在多个迁移文件中

## 变更内容

### 1. 整合现有迁移文件

将当前 5 个迁移文件整合为 3 个：
- `2026.1.23.001_init.sql` - 基础表（projects）
- `2026.1.23.002_add_cards.sql` - 卡片表
- `2026.1.23.003_add_sf_express.sql` - 顺丰速运相关表（整合 003、004、005）

### 2. 新版本号规则

采用 `YYYY.M.D.NNN` 格式：
- `YYYY` - 年份（4位）
- `M` - 月份（1-2位，不补零）
- `D` - 日期（1-2位，不补零）
- `NNN` - 当日子版本号（3位数字，从 001 开始）

示例：
- `2026.1.23.001` - 2026年1月23日的第一个迁移
- `2026.1.23.002` - 2026年1月23日的第二个迁移
- `2026.2.1.001` - 2026年2月1日的第一个迁移

### 3. 版本号解析逻辑更新

修改 `parse_version` 函数以支持新格式：
- 将 `YYYY.M.D.NNN` 转换为可比较的整数（如 `20260123001`）
- 保持向后兼容，支持旧格式（001, 002...）

## 设计要点

1. **版本号存储**：使用 `PRAGMA user_version` 存储整数版本号
2. **新旧兼容**：新版本号远大于旧版本号，确保迁移顺序正确
3. **整合原则**：只整合尚未发布的迁移，已发布版本的迁移保持不变

## 影响范围

- **修改文件**
  - `src/db/sqlite.rs` - 更新版本号解析逻辑

- **重命名/整合文件**
  - `migrations/001_init.sql` → `migrations/2026.1.23.001_init.sql`
  - `migrations/002_add_cards.sql` → `migrations/2026.1.23.002_add_cards.sql`
  - `migrations/003_add_sf_express.sql` + `004` + `005` → `migrations/2026.1.23.003_add_sf_express.sql`

## 预期效果

- 迁移文件更清晰，相关变更集中管理
- 版本号直观反映创建时间
- 便于追溯和维护
