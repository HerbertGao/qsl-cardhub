# 76x130mm QSL卡片打印模板 (v2版本)
#
# 说明:
# - 本配置文件符合 docs/template.v2.md 规范
# - 支持自适应文本布局(每行独立求最大字号)
# - 支持三种元素来源: fixed(固定值)、input(运行时输入)、computed(计算)
# - PDF和打印机后端共享同一套布局引擎

[metadata]
template_version = "2.0"
name = "QSL Card v2"
version = "1.0"
description = "标准 QSL 卡片模板，76mm × 130mm，包含中文标题"

[page]
dpi = 203                  # 打印机分辨率
width_mm = 76.0            # 纸张宽度
height_mm = 130.0          # 纸张高度
margin_left_mm = 3.0       # 左边距
margin_right_mm = 3.0      # 右边距
margin_top_mm = 4.0        # 上边距
margin_bottom_mm = 3.0     # 下边距
border = true              # 是否显示边框
border_thickness_mm = 0.3  # 边框线宽

[layout]
align_h = "center"         # 水平对齐方式: center | left | right
align_v = "center"         # 垂直对齐方式: center | top | bottom
gap_mm = 2.0               # 文本块与条码块之间的额外间距
line_gap_mm = 2.0          # 文本行之间间距

[fonts]
cn_bold = "SourceHanSansSC-Bold.otf"   # 中文粗体字体
en_bold = "LiberationSans-Bold.ttf"    # 英文粗体字体
fallback_bold = "SourceHanSansSC-Bold.otf"  # fallback粗体字体

# 元素定义: 顺序即渲染顺序
# 每个元素的 source 可以是:
#   - "fixed": 使用 value 字段的固定值
#   - "input": 使用 key 字段从运行时数据中获取值
#   - "computed": 使用 format 字段进行占位符替换

[[elements]]
id = "title"
type = "text"
source = "fixed"
value = "中国无线电协会业余分会-2区卡片局"
max_height_mm = 6.0        # 文本元素的最大高度预算

[[elements]]
id = "subtitle"
type = "text"
source = "input"
key = "task_name"          # 从运行时数据的 task_name 字段获取值
max_height_mm = 8.0

[[elements]]
id = "callsign"
type = "text"
source = "input"
key = "callsign"           # 从运行时数据的 callsign 字段获取值
max_height_mm = 28.0

[[elements]]
id = "barcode"
type = "barcode"
barcode_type = "code128"   # 条形码类型
source = "computed"
format = "{callsign}"      # 使用呼号作为条形码内容
height_mm = 18.0           # 条形码高度
quiet_zone_mm = 2.0        # 条形码左右留白(quiet zone)
human_readable = false     # 是否显示人类可读文本

[[elements]]
id = "sn"
type = "text"
source = "computed"
format = "SN: {sn}"        # 格式化字符串,支持 {field} 占位符
max_height_mm = 22.0

[[elements]]
id = "qty"
type = "text"
source = "computed"
format = "QTY: {qty}"
max_height_mm = 22.0

[output]
# 渲染模式:
#   - "text_bitmap_plus_native_barcode": 文本位图 + TSPL原生条码(方案A,推荐)
#   - "full_bitmap": 全部渲染为位图(方案B)
mode = "text_bitmap_plus_native_barcode"
threshold = 160            # 灰度转黑白阈值(0-255)
